<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Nabaztag</title>
  <link rel="stylesheet" href="http://{SERVER_URL}/milligram.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/x-icon" href="http://{SERVER_URL}/favicon.ico" />
  <style type="text/css">
/*
body {
  background: #2c2f34;
  color: #f2f2f2;
}
input, select, textarea {
  color: #f2f2f2;
}
*/
  </style>
</head>
<body>
<div class="container">
  <div class="row">
    <h1>Nabaztag</h1>
  </div>
  <div class="row">
    <div class="column">
       <ul>
         <li><a id="openAPI" href="http://andreax79.github.io/ServerlessNabaztag/vl/api/" target="_blank">API Documentation</a></li>
       </ul>
    </div>
  </div>

  <div class="row">
    <div class="column">
      <h2>Taichi</h2>
      <ul>
      <li><a href="/taichi?v=1000">Do taichi now</a></li>
      <li><a href="/taichi?v=0">Set taichi off</a></li>
      <li><a href="/taichi?v=40">Set taichi min</a></li>
      <li><a href="/taichi?v=80">Set taichi medium</a></li>
      <li><a href="/taichi?v=255">Set taichi max</a></li>
      </ul>
    </div>
    <div class="column">
      <h2>Nose</h2>
      <ul>
      <li><a href="/nose?v=0">Off</a></li>
      <li><a href="/nose?v=1">On</a></li>
      <li><a href="/nose?v=2">Todo</a></li>
      <li><a href="/nose?v=3">Urgent</a></li>
      <li><a href="/nose?v=4">Panic</a></li>
      </ul>
    </div>
    <div class="column column-50">
      <h2>Ears</h2>
      Set <strong>left</strong> ear position:<br/>
      <a href="/left?p=0&d=0">0</a>
      <a href="/left?p=1&d=0">1</a>
      <a href="/left?p=2&d=0">2</a>
      <a href="/left?p=3&d=0">3</a>
      <a href="/left?p=4&d=0">4</a>
      <a href="/left?p=5&d=0">5</a>
      <a href="/left?p=6&d=0">6</a>
      <a href="/left?p=7&d=0">7</a>
      <a href="/left?p=8&d=0">8</a>
      <a href="/left?p=9&d=0">9</a>
      <a href="/left?p=10&d=0">10</a>
      <a href="/left?p=11&d=0">11</a>
      <a href="/left?p=12&d=0">12</a>
      <a href="/left?p=13&d=0">13</a>
      <a href="/left?p=14&d=0">14</a>
      <a href="/left?p=15&d=0">15</a>
      <a href="/left?p=16&d=0">16</a>
      <br/>
      Set <strong>right</strong> ear position:<br/>
      <a href="/right?p=0&d=0">0</a>
      <a href="/right?p=1&d=0">1</a>
      <a href="/right?p=2&d=0">2</a>
      <a href="/right?p=3&d=0">3</a>
      <a href="/right?p=4&d=0">4</a>
      <a href="/right?p=5&d=0">5</a>
      <a href="/right?p=6&d=0">6</a>
      <a href="/right?p=7&d=0">7</a>
      <a href="/right?p=8&d=0">8</a>
      <a href="/right?p=9&d=0">9</a>
      <a href="/right?p=10&d=0">10</a>
      <a href="/right?p=11&d=0">11</a>
      <a href="/right?p=12&d=0">12</a>
      <a href="/right?p=13&d=0">13</a>
      <a href="/right?p=14&d=0">14</a>
      <a href="/right?p=15&d=0">15</a>
      <a href="/right?p=16&d=0">16</a>
    </div>
  </div>

  <div class="row">
    <div class="column">
      <h2>Info</h2>
      <ul>
      <li><a href="/clear">Info off</a></li>
      </ul>
    </div>
  </div>
  <div class="row">
    <div class="column">
      <h3>Weather</h3>
      <ul>
      <li><a href="/weather?v=0">Sun</a></li>
      <li><a href="/weather?v=1">Clouds</a></li>
      <li><a href="/weather?v=2">Fog</a></li>
      <li><a href="/weather?v=3">Rain</a></li>
      <li><a href="/weather?v=4">Snow</a></li>
      <li><a href="/weather?v=5">Storm</a></li>
      </ul>
    </div>
    <div class="column">
      <h3>Stock</h3>
      <ul>
      <li><a href="/stock?v=0">---</a></li>
      <li><a href="/stock?v=1">--</a></li>
      <li><a href="/stock?v=2">-</a></li>
      <li><a href="/stock?v=3">0</a></li>
      <li><a href="/stock?v=4">+</a></li>
      <li><a href="/stock?v=5">++</a></li>
      <li><a href="/stock?v=6">+++</a></li>
      </ul>
    </div>
    <div class="column">
      <h3>Traffic</h3>
      <ul>
      <li><a href="/traffic?v=0">Free</a></li>
      <li><a href="/traffic?v=1">Okay</a></li>
      <li><a href="/traffic?v=2">Moderate</a></li>
      <li><a href="/traffic?v=3">Normal</a></li>
      <li><a href="/traffic?v=4">Heavy</a></li>
      <li><a href="/traffic?v=5">Congested</a></li>
      <li><a href="/traffic?v=6">Extreme</a></li>
      </ul>
    </div>
    <div class="column">
      <h3>Pollution</h3>
      <ul>
      <li><a href="/pollution?v=0">0</a></li>
      <li><a href="/pollution?v=1">1</a></li>
      <li><a href="/pollution?v=2">2</a></li>
      <li><a href="/pollution?v=3">3</a></li>
      <li><a href="/pollution?v=4">4</a></li>
      <li><a href="/pollution?v=5">5</a></li>
      <li><a href="/pollution?v=6">6</a></li>
      <li><a href="/pollution?v=7">7</a></li>
      <li><a href="/pollution?v=8">8</a></li>
      <li><a href="/pollution?v=9">9</a></li>
      <li><a href="/pollution?v=10">10</a></li>
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="column">
      <h2>Play sound</h2>
      <ul>
      <li><a href="/communication">Communication</a></li>
      <li><a href="/ack">Ack</a></li>
      <li><a href="/abort">Abort</a></li>
      <li><a href="/ministop">Ministop</a></li>
      </ul>
    </div>
    <div class="column column-75">
      <h2>&nbsp;</h2>
      <form action="/play" method="GET">
        <fieldset>
          <label for="mp3uriField">Play MP3 file</label>
          (http only, https is not supported)
          <input type="text" name="u" id="mp3uriField" placeholder="http://ia800304.us.archive.org/14/items/SadTrombone/73581__benboncan__sad-trombone.mp3" />
          <input class="button-primary" type="submit" value="Play">
      </fieldset>
      </form>
      <form action="/say" method="GET">
        <fieldset>
          <label for="textToSpeachField">Text to speach</label>
          <input type="text" name="t" id="textToSpeachField" />
          <input class="button-primary" type="submit" value="Say">
      </fieldset>
      </form>
    </div>
  </div>

  <div class="row">
    <div class="column">
      <h2>Util</h2>
      <ul>
      <li><a href="/surprise">Surprise</a></li>
      <li><a href="/stop">Stop everything</a></li>
      </ul>
    </div>
    <div class="column">
      <h2>Sleep</h2>
      <ul>
      <li><a href="/sleep">Sleep</a></li>
      <li><a href="/wakeup">Wake up</a></li>
      </ul>
    </div>
    <div class="column column-50">
      <h2>System</h2>
      <p>MAC Address: <strong id="macAddress"></strong></p>
      <ul>
      <li><a href="/status">Get status as JSON</a></li>
      <li><a href="/update-time">Update time from timeserver</a></li>
      <li><a href="/update-weather">Update weather info</a></li>
      <li><a href="/reboot">Reboot</a></li>
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="column">
      <h2>Setup</h2>
    </div>
  </div>
  <form action="/setup" method="GET">
    <fieldset>
      <div class="row">
        <div class="column">
            <label for="latitudeField">Latitude</label>
            <input name="j" type="text" placeholder="45.464" id="latitudeField" />
        </div>
        <div class="column">
            <label for="longitudeField">Longitude</label>
            <input name="k" type="text" placeholder="9.1895" id="longitudeField" />
        </div>
        <div class="column column-50">
            <label for="langField">Language</label>
            <select name="l" id="langField">
            <option value="uk">English</option>
            <option value="it">Italian</option>
            <option value="fr">French</option>
            <option value="es">Spanish</option>
            <option value="de">German</option>
            </select>
        </div>
      </div>
      <div class="row">
        <div class="column">
            <label for="cityCodeField">City (Timezone)</label>
            <select name="c" id="cityCodeField"></select>
            <input class="button-primary" type="submit" value="Set">
        </div>
        <div class="column">
            <label for="dstField">Daylight Saving Time</label>
            <select name="d" id="dstField">
            <option value="0">Off</option>
            <option value="1">On</option>
            </select>
        </div>
        <div class="column">
            <label for="wakeUpField">Wake up</label>
            <input name="w" type="number" min="0" max="23" placeholder="7" id="wakeUpField" />
        </div>
        <div class="column">
            <label for="goToBedField">Go to bed</label>
            <input name="b" type="number" min="0" max="23" placeholder="22" id="goToBedField" />
        </div>
      </div>
    </fieldset>
  </form>

  <div class="row">
    <div class="column">
      <h2>Forth</h2>
      <form action="/forth" method="POST">
        <fieldset>
          <label for="codeField">Forth code</label>
          <textarea name="c" id="codeField">words</textarea>
          <input class="button-primary" type="submit" value="Play">
      </fieldset>
      </form>
    </div>
  </div>

  <footer class="footer">
     <a href="https://github.com/andreax79/ServerlessNabaztag" target="_blank" title="ServerlessNabaztag">github.com/andreax79/ServerlessNabaztag</a>
     - <span id="revision"></span>
  </footer>
</div>
<script>
async function loadTimezones(city_code) {
    const response = await fetch('/timezones');
    const timezones = await response.json();
    const select = document.getElementById('cityCodeField');
    select.innerHTML = '';

    // Populate the select
    timezones.forEach(tz => {
        const option = document.createElement('option');
        option.value = tz.code;
        option.textContent = tz.name;
        select.appendChild(option);
    });

    let cityCodeOption = document.querySelector('#cityCodeField option[value="' + city_code + '"]');
    if (cityCodeOption){
        cityCodeOption.setAttribute('selected', 'selected');
    }
}

async function onLoad() {
    const response = await fetch('/status');
    const status = await response.json();
    console.log(status);
    document.getElementById("macAddress").innerHTML = status.wifi.mac;
    document.getElementById("revision").innerHTML = status.rev;

    let langOption = document.querySelector('#langField option[value="' + status.language + '"]');
    if (langOption){
        langOption.setAttribute('selected', 'selected');
    }

    let dstOption = document.querySelector('#dstField option[value="' + status.time.dst + '"]');
    if (dstOption){
        dstOption.setAttribute('selected', 'selected');
    }

    document.getElementById("latitudeField").value = status.latitude;
    document.getElementById("longitudeField").value = status.longitude;
    document.getElementById("wakeUpField").value = status.wake_up;
    document.getElementById("goToBedField").value = status.go_to_bed;

    document.getElementById("openAPI").href += "?openapi_url=http%3A%2F%2F" + window.location.host + "%2Fopenapi.yaml";
    loadTimezones(status.time.city_code);
}

document.addEventListener('DOMContentLoaded', onLoad);
</script>
</body>
</html>
