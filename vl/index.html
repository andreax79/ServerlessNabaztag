<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Nabaztag</title>
  <link rel="stylesheet" href="http://{SERVER_URL}/milligram.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/x-icon" href="http://{SERVER_URL}/favicon.ico" />
  <style type="text/css">
/*
body {
  background: #2c2f34;
  color: #f2f2f2;
}
input, select, textarea {
  color: #f2f2f2;
}
*/
  </style>
</head>
<body>
<div class="container">
  <div class="row">
    <h1>Nabaztag</h1>
  </div>
  <div class="row">
    <div class="column">
       <ul>
         <li><a id="openAPI" href="http://andreax79.github.io/ServerlessNabaztag/vl/api/" target="_blank">API Documentation</a></li>
       </ul>
    </div>
  </div>

  <h3 class="title">Info</h3>

  <div class="row">
    <div class="column">
      <form action="/weather" method="GET">
        <fieldset>
            <label for="weatherField">Weather</label>
            <select name="v" id="weatherField" onchange="this.form.submit()">
            <option value="-1"></option>
            <option value="0">Sun</option>
            <option value="1">Clouds</option>
            <option value="2">Fog</option>
            <option value="3">Rain</option>
            <option value="4">Snow</option>
            <option value="5">Storm</option>
            </select>
        </fieldset>
      </form>
    </div>
    <div class="column">
      <form action="/pollution" method="GET">
        <fieldset>
            <label for="pollutionField">Pollution</label>
            <select name="v" id="pollutionField" onchange="this.form.submit()">
            <option value="-1"></option>
            <option value="0">Good</option>
            <option value="1">Good-Fair</option>
            <option value="2">Fair</option>
            <option value="3">Fair-Moderate</option>
            <option value="4">Moderate</option>
            <option value="5">Moderate-Poor</option>
            <option value="6">Poor</option>
            <option value="7">Poor-very poor</option>
            <option value="8">Very poor</option>
            <option value="9">Very-extremly poor</option>
            <option value="10">Extremly poor</option>
            </select>
        </fieldset>
      </form>
    </div>
    <div class="column">
      <form action="/traffic" method="GET">
        <fieldset>
            <label for="trafficField">Traffic</label>
            <select name="v" id="trafficField" onchange="this.form.submit()">
            <option value="-1"></option>
            <option value="0">Free</option>
            <option value="1">Okay</option>
            <option value="2">Moderate</option>
            <option value="3">Normal</option>
            <option value="4">Heavy</option>
            <option value="5">Congested</option>
            <option value="6">Extreme</option>
            </select>
        </fieldset>
      </form>
    </div>
    <div class="column">
      <form action="/stock" method="GET">
        <fieldset>
            <label for="stockField">Stock</label>
            <select name="v" id="stockField" onchange="this.form.submit()">
            <option value="-1"></option>
            <option value="0">---</option>
            <option value="1">--</option>
            <option value="2">-</option>
            <option value="3">0</option>
            <option value="4">+</option>
            <option value="5">++</option>
            <option value="6">+++</option>
            </select>
        </fieldset>
      </form>
    </div>
  </div>

  <div class="row">
    <div class="column column-25">
      <form action="/mail" method="GET">
        <fieldset>
            <label for="emailsField">E-mail</label>
            <select name="v" id="emailsField" onchange="this.form.submit()">
            <option value="-1"></option>
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            </select>
        </fieldset>
      </form>
    </div>
    <div class="column column-25">
      <form action="/nose" method="GET">
        <fieldset>
            <label for="noseField">Messages (nose)</label>
            <select name="v" id="noseField" onchange="this.form.submit()">
            <option value="0">Off</option>
            <option value="1">On</option>
            <option value="2">Todo</option>
            <option value="3">Urgent</option>
            <option value="4">Panic</option>
            </select>
        </fieldset>
      </form>
    </div>
    <div class="column column-50">
        <label>&nbsp;</label>
        <button type="button" class="button button-outline" onclick="clearInfo()">Clear all info</button>
        <button type="button" class="button button-outline" onclick="fetch('update-weather');">Update weather/pollution info</button>
    </div>
  </div>

  <h3 class="title">Ears</h3>

  <form action="/left" method="GET">
      <fieldset>
          <div class="row">
              <div class="column column-25">
                  <label for="leftEarPositionField">Left ear position</label>
                  <select name="p" id="leftEarPositionField">
                      <option value="0">0</option>
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3">3</option>
                      <option value="4">4</option>
                      <option value="5">5</option>
                      <option value="6">6</option>
                      <option value="7">7</option>
                      <option value="8">8</option>
                      <option value="9">9</option>
                      <option value="10">10</option>
                      <option value="11">11</option>
                      <option value="12">12</option>
                      <option value="13">13</option>
                      <option value="14">14</option>
                      <option value="15">15</option>
                      <option value="16">16</option>
                  </select>
              </div>
              <div class="column column-25">
                  <label for="leftEarDirectionField">Direction</label>
                  <select name="d" id="leftEarDirectionField">
                      <option value="0">Forward</option>
                      <option value="1">Backward</option>
                  </select>
              </div>
              <div class="column column-25">
                  <label>&nbsp;</label>
                  <button class="button" style="width: 100%" onclick="this.form.submit()">Set left ear position</button>
              </div>
          </div>
      </fieldset>
  </form>

  <form action="/right" method="GET">
      <fieldset>
          <div class="row">
              <div class="column column-25">
                  <label for="rightEarPositionField">Right ear position</label>
                  <select name="p" id="rightEarPositionField">
                      <option value="0">0</option>
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3">3</option>
                      <option value="4">4</option>
                      <option value="5">5</option>
                      <option value="6">6</option>
                      <option value="7">7</option>
                      <option value="8">8</option>
                      <option value="9">9</option>
                      <option value="10">10</option>
                      <option value="11">11</option>
                      <option value="12">12</option>
                      <option value="13">13</option>
                      <option value="14">14</option>
                      <option value="15">15</option>
                      <option value="16">16</option>
                  </select>
              </div>
              <div class="column column-25">
                  <label for="rightEarDirectionField">Direction</label>
                  <select name="d" id="rightEarDirectionField">
                      <option value="0">Forward</option>
                      <option value="1">Backward</option>
                  </select>
              </div>
              <div class="column column-25">
                  <label>&nbsp;</label>
                  <button class="button" style="width: 100%" onclick="this.form.submit()">Set right ear position</button>
              </div>
          </div>
      </fieldset>
  </form>

  <h3 class="title">Leds</h3>

  <div class="row">
    <div class="column">
      <form action="/leds" method="POST">
        <fieldset>
            <label for="ledNoseField">Nose</label>
            <input type="color" name="n" id="ledNoseField" value="" placeholder="#RRGGBB" />
            <button type="button" class="button" onclick="this.form.submit();">Set</button>
            <button type="button" class="button button-outline" onclick="this.form.ledNoseField.value=-1; fetch('/leds?n=-1');">Clear</button>
        </fieldset>
      </form>
    </div>
    <div class="column">
      <form action="/leds" method="POST">
        <fieldset>
            <label for="ledLeftField">Left</label>
            <input type="color" name="l" id="ledLeftField" value="" placeholder="#RRGGBB" />
            <button type="button" class="button" onclick="this.form.submit();">Set</button>
            <button type="button" class="button button-outline" onclick="this.form.ledLeftField.value=-1; fetch('/leds?l=-1');">Clear</button>
        </fieldset>
      </form>
    </div>
    <div class="column">
      <form action="/leds" method="POST">
        <fieldset>
            <label for="ledMiddleField">Middle</label>
            <input type="color" name="c" id="ledMiddleField" value="" placeholder="#RRGGBB" />
            <button type="button" class="button" onclick="this.form.submit();">Set</button>
            <button type="button" class="button button-outline" onclick="this.form.ledMiddleField.value=-1; fetch('/leds?c=-1');">Clear</button>
        </fieldset>
      </form>
    </div>
    <div class="column">
      <form action="/leds" method="POST">
        <fieldset>
            <label for="ledRightField">Right</label>
            <input type="color" name="r" id="ledRightField" value="" placeholder="#RRGGBB" />
            <button type="button" class="button" onclick="this.form.submit();">Set</button>
            <button type="button" class="button button-outline" onclick="this.form.ledRightField.value=-1; fetch('/leds?r=-1');">Clear</button>
        </fieldset>
      </form>
    </div>
  </div>

  <h3 class="title">Sound</h3>

  <div class="row">
    <div class="column">
      <label>Play MIDI</label>
      <ul>
      <li><a href="/communication">Communication</a></li>
      <li><a href="/ack">Ack</a></li>
      <li><a href="/abort">Abort</a></li>
      <li><a href="/ministop">Ministop</a></li>
      </ul>
    </div>
    <div class="column column-75">
      <form action="/play" method="GET">
        <fieldset>
          <label for="mp3uriField">Play MP3 file</label>
          (http only, https is not supported)
          <input type="text" name="u" id="mp3uriField" placeholder="http://ia800304.us.archive.org/14/items/SadTrombone/73581__benboncan__sad-trombone.mp3" />
          <input class="button" type="submit" value="Play">
      </fieldset>
      </form>
      <form action="/say" method="GET">
        <fieldset>
          <label for="textToSpeachField">Text to speach</label>
          <input type="text" name="t" id="textToSpeachField" />
          <input class="button" type="submit" value="Say">
      </fieldset>
      </form>
    </div>
  </div>

  <div class="row">
    <div class="column">
      <h3>Util</h3>
      <ul>
      <li><a href="/taichi">Tai Chi</a></li>
      <li><a href="/surprise">Surprise</a></li>
      <li><a href="/stop">Stop everything</a></li>
      </ul>
    </div>
    <div class="column">
      <h3>Sleep</h3>
      <ul>
      <li><a href="/sleep">Sleep</a></li>
      <li><a href="/wakeup">Wake up</a></li>
      </ul>
    </div>
    <div class="column column-50">
      <h3>System</h3>
      <p>MAC Address: <strong id="macAddress"></strong></p>
      <ul>
      <li><a href="/status">Get status as JSON</a></li>
      <li><a href="/update-time">Update time from timeserver</a></li>
      <li><a href="/reboot">Reboot</a></li>
      </ul>
    </div>
  </div>

  <h3 class="title">Setup</h3>

  <form action="/setup" method="GET">
    <fieldset>
      <div class="row">
        <div class="column">
            <label for="latitudeField">Latitude</label>
            <input name="j" type="text" placeholder="45.464" id="latitudeField" />
        </div>
        <div class="column">
            <label for="longitudeField">Longitude</label>
            <input name="k" type="text" placeholder="9.1895" id="longitudeField" />
        </div>
        <div class="column">
            <label for="langField">Language</label>
            <select name="l" id="langField">
            <option value="uk">English</option>
            <option value="it">Italian</option>
            <option value="fr">French</option>
            <option value="es">Spanish</option>
            <option value="de">German</option>
            </select>
        </div>
        <div class="column">
            <label for="taichiField">Tai Chi</label>
            <select name="t" id="taichiField">
            <option value="0">Off</option>
            <option value="40">Min</option>
            <option value="80">Medium</option>
            <option value="255">Max</option>
            </select>
        </div>
      </div>
      <div class="row">
        <div class="column">
            <label for="cityCodeField">City (Timezone)</label>
            <select name="c" id="cityCodeField"></select>
            <input class="button" type="submit" value="Set">
        </div>
        <div class="column">
            <label for="dstField">Daylight Saving Time</label>
            <select name="d" id="dstField">
            <option value="0">Off</option>
            <option value="1">On</option>
            </select>
        </div>
        <div class="column">
            <label for="wakeUpField">Wake up</label>
            <input name="w" type="number" min="0" max="23" placeholder="7" id="wakeUpField" />
        </div>
        <div class="column">
            <label for="goToBedField">Go to bed</label>
            <input name="b" type="number" min="0" max="23" placeholder="22" id="goToBedField" />
        </div>
      </div>
    </fieldset>
  </form>

  <h3 class="title">Forth</h3>

  <div class="row">
    <div class="column">
      <form action="/forth" method="POST">
        <fieldset>
          <label for="codeField">Forth code</label>
          <textarea name="c" id="codeField">words</textarea>
          <input class="button" type="submit" value="Play">
      </fieldset>
      </form>
    </div>
  </div>

  <footer class="footer">
     <a href="https://github.com/andreax79/ServerlessNabaztag" target="_blank" title="ServerlessNabaztag">github.com/andreax79/ServerlessNabaztag</a>
     - <span id="revision"></span>
  </footer>
</div>
<script>
async function loadTimezones(city_code) {
    const response = await fetch('/timezones');
    const timezones = await response.json();
    const select = document.getElementById('cityCodeField');
    select.innerHTML = '';

    // Populate the select
    timezones.forEach(tz => {
        const option = document.createElement('option');
        option.value = tz.code;
        option.textContent = tz.name;
        select.appendChild(option);
    });

    // Set the selected value
    document.querySelector('#cityCodeField').value = city_code;
}

async function clearInfo() {
    fetch('/clear');
    document.querySelector('#weatherField').value=-1;
    document.querySelector('#stockField').value=-1;
    document.querySelector('#trafficField').value=-1;
    document.querySelector('#pollutionField').value=-1;
    document.querySelector('#emailsField').value=-1;
    document.querySelector('#noseField').value=0;
}

function formatColor(c) {
    if (c == -1)
        return -1;
    return "#" + Number(c).toString(16).padStart(6, '0');
}

async function onLoad() {
    const response = await fetch('/status');
    const status = await response.json();
    document.getElementById("macAddress").innerHTML = status.wifi.mac;
    document.getElementById("revision").innerHTML = status.rev;

    document.querySelector('#langField').value = status.language;
    document.querySelector('#taichiField').value = status.taichi_freq;
    document.querySelector('#dstField').value = status.time.dst;

    document.getElementById("latitudeField").value = status.latitude;
    document.getElementById("longitudeField").value = status.longitude;
    document.getElementById("wakeUpField").value = status.wake_up;
    document.getElementById("goToBedField").value = status.go_to_bed;

    document.querySelector('#weatherField').value = status.info.weather;
    document.querySelector('#stockField').value = status.info.stock;
    document.querySelector('#trafficField').value = status.info.traffic;
    document.querySelector('#pollutionField').value = status.info.pollution;
    document.querySelector('#emailsField').value = status.info.emails;
    document.querySelector('#noseField').value = status.info.messages;

    document.getElementById("ledNoseField").value = formatColor(status.leds.overrides.nose);
    document.getElementById("ledLeftField").value = formatColor(status.leds.overrides.left);
    document.getElementById("ledMiddleField").value = formatColor(status.leds.overrides.middle);
    document.getElementById("ledRightField").value = formatColor(status.leds.overrides.right);

    document.getElementById("openAPI").href += "?openapi_url=http%3A%2F%2F" + window.location.host + "%2Fopenapi.yaml";
    loadTimezones(status.time.city_code);
}

document.addEventListener('DOMContentLoaded', onLoad);
</script>
</body>
</html>
