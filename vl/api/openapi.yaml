openapi: 3.0.3
info:
  title: Serverless Nabaztag API
  description: An OpenAPI specification for controlling a Serverless Nabaztag smart rabbit.
  version: 1.0.5
  contact:
    url: https://github.com/andreax79/ServerlessNabaztag
servers:
  - url: http://{nabaztag_ip}
    description: Local Nabaztag device
    variables:
      nabaztag_ip:
        default: 192.168.1.100
        description: The IP address of your Nabaztag rabbit.
paths:
  /taichi:
    get:
      summary: Do Tai Chi
      tags: [Actions]
      description: Do Tai Chi choreography.
      responses:
        '204':
          description: Command sent successfully.
  /nose:
    get:
      summary: Control the nose LED
      tags: [Services]
      description: Sets the color or state of the nose LED to indicate a status.
      parameters:
        - name: v
          in: query
          required: true
          description: The desired state for the nose LED.
          schema:
            type: integer
            enum: [0, 1, 2, 3, 4]
      responses:
        '204':
          description: Command sent successfully.
  /left:
    get:
      summary: Set left ear position
      tags: [Ears]
      description: Moves the left ear to a specific position.
      parameters:
        - name: p
          in: query
          required: true
          description: The target position for the left ear.
          schema:
            type: integer
            minimum: 0
            maximum: 16
        - name: d
          in: query
          required: true
          description: Direction parameter (`0` forward, `1` backward).
          schema:
            type: integer
            enum: [0, 1]
      responses:
        '204':
          description: Command sent successfully.
  /right:
    get:
      summary: Set right ear position
      tags: [Ears]
      description: Moves the right ear to a specific position.
      parameters:
        - name: p
          in: query
          required: true
          description: The target position for the right ear.
          schema:
            type: integer
            minimum: 0
            maximum: 16
        - name: d
          in: query
          required: true
          description: Direction parameter (`0` forward, `1` backward).
          schema:
            type: integer
            enum: [0, 1]
      responses:
        '204':
          description: Command sent successfully.
  /clear:
    get:
      summary: Clear the status of all services
      tags: [Services]
      description: Clears the status of all the services, resetting the state of all informational LEDs (e.g. weather, traffic).
      responses:
        '204':
          description: Command sent successfully.
  /weather:
    get:
      summary: Set weather status
      tags: [Services]
      description: Sets the LEDs to show a specific weather condition.
      parameters:
        - name: v
          in: query
          required: true
          description: The weather condition to display.
          schema:
            type: integer
            enum: [0, 1, 2, 3, 4, 5]
      responses:
        '204':
          description: Command sent successfully.
  /stock:
    get:
      summary: Set stock market trend
      tags: [Services]
      description: Sets the LEDs to show a stock market trend.
      parameters:
        - name: v
          in: query
          required: true
          description: The stock market trend to display.
          schema:
            type: integer
            enum: [0, 1, 2, 3, 4, 5, 6]
      responses:
        '204':
          description: Command sent successfully.
  /traffic:
    get:
      summary: Set traffic condition
      tags: [Services]
      description: Sets the LEDs to show the current traffic condition.
      parameters:
        - name: v
          in: query
          required: true
          description: The traffic condition to display.
          schema:
            type: integer
            enum: [0, 1, 2, 3, 4, 5, 6]
      responses:
        '204':
          description: Command sent successfully.
  /pollution:
    get:
      summary: Set pollution level
      tags: [Services]
      description: Sets the LEDs to show the air pollution level.
      parameters:
        - name: v
          in: query
          required: true
          description: The pollution level to display.
          schema:
            type: integer
            minimum: 0
            maximum: 10
      responses:
        '204':
          description: Command sent successfully.
  /service4:
    get:
      summary: Set generic service 4 status
      tags: [Services]
      description: Sets the LEDs to show the status of the generic service 4.
      parameters:
        - name: v
          in: query
          required: true
          description: The generic service 4 status to display.
          schema:
            type: integer
      responses:
        '204':
          description: Command sent successfully.
  /service5:
    get:
      summary: Set generic service 5 status
      tags: [Services]
      description: Sets the LEDs to show the status of the generic service 5.
      parameters:
        - name: v
          in: query
          required: true
          description: The generic service 5 status to display.
          schema:
            type: integer
      responses:
        '204':
          description: Command sent successfully.
  /mail:
    get:
      summary: Set mail status
      tags: [Services]
      description: Sets the LEDs to show mail status.
      parameters:
        - name: v
          in: query
          required: true
          description: The mail status to display.
          schema:
            type: integer
            enum: [0, 1, 2, 3]
      responses:
        '204':
          description: Command sent successfully.
  /leds:
    post:
      summary: Set LED colors override
      tags: [Leds]
      description: |
        Sets nose (n), left (l), center (c), right (r), and base (b) LED colors.
        Each parameter accepts a hex color in the form `#rrggbb`
        or `-1` to disable the LED override.
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                n:
                  type: string
                  description: Nose LED color override
                  pattern: '^(-1|#[0-9A-Fa-f]{6})$'
                  example: "-1"
                l:
                  type: string
                  description: Left LED color override
                  pattern: '^(-1|#[0-9A-Fa-f]{6})$'
                  example: "#ff0000"
                c:
                  type: string
                  description: Center LED color override
                  pattern: '^(-1|#[0-9A-Fa-f]{6})$'
                  example: "#00ff00"
                r:
                  type: string
                  description: Right LED color override
                  pattern: '^(-1|#[0-9A-Fa-f]{6})$'
                  example: "-1"
                b:
                  type: string
                  description: Base LED color override
                  pattern: '^(-1|#[0-9A-Fa-f]{6})$'
                  example: "-1"
      responses:
        '204':
          description: Command sent successfully.
  /communication:
    get:
      summary: Play 'Communication' sound
      tags: [Sound]
      responses:
        '204':
          description: Command sent successfully.
  /ack:
    get:
      summary: Play 'Ack' sound
      tags: [Sound]
      responses:
        '204':
          description: Command sent successfully.
  /abort:
    get:
      summary: Play 'Abort' sound
      tags: [Sound]
      responses:
        '204':
          description: Command sent successfully.
  /ministop:
    get:
      summary: Play 'Ministop' sound
      tags: [Sound]
      responses:
        '204':
          description: Command sent successfully.
  /play:
    get:
      summary: Play an MP3 from a URL
      tags: [Sound]
      description: Streams and plays an MP3 file from a given HTTP URL. HTTPS is not supported.
      parameters:
        - name: u
          in: query
          required: true
          description: The HTTP URL of the MP3 file to play.
          schema:
            type: string
            format: uri
      responses:
        '204':
          description: Command sent successfully.
  /say:
    get:
      summary: Text to Speech
      tags: [Sound]
      description: Makes the Nabaztag speak the provided text.
      parameters:
        - name: t
          in: query
          required: true
          description: The text to be spoken.
          schema:
            type: string
      responses:
        '204':
          description: Command sent successfully.
  /surprise:
    get:
      summary: Perform a surprise action
      tags: [Actions]
      description: Triggers the surprise action, which includes ear movements and sound.
      responses:
        '204':
          description: Command sent successfully.
  /stop:
    get:
      summary: Stop everything
      tags: [Actions]
      description: Halts all current movements and sound playback.
      responses:
        '204':
          description: Command sent successfully.
  /sleep:
    get:
      summary: Put Nabaztag to sleep
      tags: [Sleep]
      responses:
        '204':
          description: Command sent successfully.
  /wakeup:
    get:
      summary: Wake up Nabaztag
      tags: [Sleep]
      responses:
        '204':
          description: Command sent successfully.
  /status:
    get:
      summary: Get device status
      tags: [System]
      description: Returns the current status of the Nabaztag as a JSON object.
      responses:
        '200':
          description: A JSON object with the device's status.
          content:
            application/json:
              schema:
                type: object
  /animations:
    get:
      summary: Get service animations
      tags: [Services]
      description: Returns the available Nabaztag animations grouped by service.
      responses:
        '200':
          description: Animations grouped by service
          content:
            application/json:
              schema:
                type: object
  /update-time:
    get:
      summary: Update system time
      tags: [System]
      description: Forces an update of the system time from an NTP server.
      responses:
        '204':
          description: Command sent successfully.
  /update-weather:
    get:
      summary: Update weather info
      tags: [System]
      description: Forces an update of the weather information using the configured location.
      responses:
        '204':
          description: Command sent successfully.
  /reboot:
    get:
      summary: Reboot the Nabaztag
      tags: [System]
      description: Restarts the Nabaztag.
      responses:
        '204':
          description: Command sent successfully.
  /setup:
    get:
      summary: Configure the Nabaztag settings
      tags: [System]
      description: Sets various system-level configurations.
      parameters:
        - name: j
          in: query
          description: Latitude.
          schema:
            type: number
        - name: k
          in: query
          description: Longitude.
          schema:
            type: number
        - name: l
          in: query
          description: Language.
          schema:
            type: string
            enum: [uk, it, fr, es, de]
        - name: c
          in: query
          description: City code for timezone.
          schema:
            type: string
        - name: d
          in: query
          description: Daylight Saving Time setting.
          schema:
            type: integer
            enum: [0, 1]
        - name: w
          in: query
          description: The hour the Nabaztag should automatically wake up (0-23).
          schema:
            type: integer
            minimum: 0
            maximum: 23
        - name: b
          in: query
          description: The hour the Nabaztag should automatically go to sleep (0-23).
          schema:
            type: integer
            minimum: 0
            maximum: 23
        - name: t
          in: query
          description: Tai Chi frequency.
          schema:
            type: integer
            enum: [0, 40, 80, 255]
      responses:
        '204':
          description: Command sent successfully.
  /tasks:
    get:
      summary: Get tasks
      tags: [System]
      description: Returns the tasks list as a JSON object.
      responses:
        '200':
          description: A JSON object with the tasks status.
          content:
            application/json:
              schema:
                type: object
  /forth:
    post:
      summary: Execute Forth code
      tags: [Forth]
      description: Executes the provided Forth code on the device.
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - c
              properties:
                c:
                  type: string
                  description: Forth code to be executed
                  example: "left-ear forward 10 move-ear"
      responses:
        '200':
          description: Forth code executed.
          content:
            application/json:
              schema:
                type: object
